{
  "variables": {
    "identity_endpoint": "{{env `OS_AUTH_URL`}}",
    "tenant_id": "{{env `OS_PROJECT_ID`}}",
    "username": "{{env `OS_USERNAME`}}",
    "password": "{{env `OS_PASSWORD`}}",
    "region": "{{env `OS_REGION_NAME`}}",
    "network_id": "{{env `PACKER_NETWORK_ID`}}"
  },
  "provisioners": [
    {
      "type": "ansible",
      "playbook_file": "./playbooks/packer.yml",
      "ansible_env_vars": [
        "ANSIBLE_SCP_IF_SSH=y",
        "ANSIBLE_HOST_KEY_CHECKING=False",
        "ANSIBLE_SSH_RETRIES=10",
        "ANSIBLE_PIPELINING=True"
      ],
      "groups": [
        "hadoop-cluster"
      ],
      "extra_arguments": [
        "--timeout",
        "60"
      ]
    }
  ],
  "builders": [
    {
      "type": "openstack",
      "username": "{{user `username`}}",
      "password": "{{user `password`}}",
      "ssh_username": "centos",
      "image_name": "Analytics Ambari pre-warmed 2.6.2.0",
      "source_image_name": "Analytics Base image",
      "flavor": "r2-15",
      "region": "{{user `region`}}",
      "identity_endpoint": "{{user `identity_endpoint`}}",
      "tenant_id": "{{user `tenant_id`}}",
      "networks": [
        "{{user `network_id`}}"
      ],
      "image_visibility": "private",
      "ssh_ip_version": "4"
    }
  ]
}